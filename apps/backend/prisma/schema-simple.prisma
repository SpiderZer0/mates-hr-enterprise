generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Simplified Schema for Quick Start

model User {
  id                String      @id @default(cuid())
  email             String      @unique
  username          String      @unique
  password          String
  firstName         String
  lastName          String
  phoneNumber       String?
  avatar            String?
  isActive          Boolean     @default(true)
  emailVerified     Boolean     @default(false)
  lastSeenAt        DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  companyId         String?
  company           Company?    @relation(fields: [companyId], references: [id])
  
  employee          Employee?
  userRoles         UserRole[]
  sessions          Session[]
  notifications     Notification[]
  
  @@map("users")
}

model Company {
  id                String      @id @default(cuid())
  name              String
  code              String      @unique
  email             String?
  phone             String?
  address           String?
  website           String?
  logoUrl           String?
  isActive          Boolean     @default(true)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  users             User[]
  roles             Role[]
  departments       Department[]
  employees         Employee[]
  
  @@map("companies")
}

model Role {
  id                String      @id @default(cuid())
  name              String
  description       String?
  permissions       Json?
  companyId         String
  company           Company     @relation(fields: [companyId], references: [id])
  
  userRoles         UserRole[]
  
  @@unique([name, companyId])
  @@map("roles")
}

model UserRole {
  id                String      @id @default(cuid())
  userId            String
  user              User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  roleId            String
  role              Role        @relation(fields: [roleId], references: [id], onDelete: Cascade)
  assignedAt        DateTime    @default(now())
  
  @@unique([userId, roleId])
  @@map("user_roles")
}

model Session {
  id                String      @id @default(cuid())
  sessionToken      String      @unique
  userId            String
  user              User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt         DateTime
  createdAt         DateTime    @default(now())
  
  @@map("sessions")
}

model Department {
  id                String      @id @default(cuid())
  name              String
  code              String
  description       String?
  companyId         String
  company           Company     @relation(fields: [companyId], references: [id])
  parentId          String?
  
  employees         Employee[]
  
  @@unique([code, companyId])
  @@map("departments")
}

model Employee {
  id                String      @id @default(cuid())
  userId            String      @unique
  user              User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  employeeCode      String      @unique
  departmentId      String?
  department        Department? @relation(fields: [departmentId], references: [id])
  position          String?
  joinDate          DateTime
  employmentType    String      @default("FULL_TIME")
  status            String      @default("ACTIVE")
  companyId         String
  company           Company     @relation(fields: [companyId], references: [id])
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  attendances       Attendance[]
  leaves            Leave[]
  
  @@map("employees")
}

model Attendance {
  id                String      @id @default(cuid())
  employeeId        String
  employee          Employee    @relation(fields: [employeeId], references: [id])
  date              DateTime
  checkIn           DateTime?
  checkOut          DateTime?
  status            String      @default("PRESENT")
  workingHours      Float?
  overtimeHours     Float?
  notes             String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  @@unique([employeeId, date])
  @@map("attendances")
}

model LeaveType {
  id                String      @id @default(cuid())
  name              String
  code              String      @unique
  daysAllowed       Int
  isPaid            Boolean     @default(true)
  requiresApproval  Boolean     @default(true)
  requiresDocument  Boolean     @default(false)
  description       String?
  companyId         String
  
  leaves            Leave[]
  
  @@map("leave_types")
}

model Leave {
  id                String      @id @default(cuid())
  employeeId        String
  employee          Employee    @relation(fields: [employeeId], references: [id])
  leaveTypeId       String
  leaveType         LeaveType   @relation(fields: [leaveTypeId], references: [id])
  startDate         DateTime
  endDate           DateTime
  totalDays         Float
  reason            String
  status            String      @default("PENDING")
  approvedById      String?
  approvalDate      DateTime?
  rejectionReason   String?
  documentUrl       String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  @@map("leaves")
}

model Notification {
  id                String      @id @default(cuid())
  userId            String
  user              User        @relation(fields: [userId], references: [id])
  type              String      @default("INFO")
  priority          String      @default("NORMAL")
  title             String
  body              String
  actionUrl         String?
  metadata          Json?
  isRead            Boolean     @default(false)
  readAt            DateTime?
  createdAt         DateTime    @default(now())
  
  @@map("notifications")
}

model Project {
  id                String      @id @default(cuid())
  name              String
  code              String      @unique
  description       String?
  status            String      @default("PLANNING")
  startDate         DateTime
  endDate           DateTime?
  budget            Float?
  budgetCurrency    String?
  companyId         String
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  tasks             Task[]
  
  @@map("projects")
}

model Task {
  id                String      @id @default(cuid())
  projectId         String
  project           Project     @relation(fields: [projectId], references: [id])
  title             String
  description       String?
  status            String      @default("TODO")
  priority          String      @default("MEDIUM")
  assigneeId        String?
  dueDate           DateTime?
  estimatedMinutes  Int?
  actualMinutes     Int?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  @@map("tasks")
}
